<?php /*

Plugin Name: London Events Guide
Version: 3.0
Plugin URI: http://www.londondrum.com/events/
Description: Displays a constantly updating list of London events. There are 5 categories... everything from art exhibitions and concerts to theatre shows.
Author: London Drum
Author URI: http://www.londondrum.com/

Copyright (c) 2009
Released under the GPL license
http://www.gnu.org/licenses/gpl.txt

This file is part of WordPress.
WordPress is free software;you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation;either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY;without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program;if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

*/

function london_events(){$type=get_option('choose_type');if($type==''){$type='pick';}$itemnum=get_option('choose_itemnum');if($itemnum==''){$itemnum='3';}$itemdescr=get_option('choose_itemdescr');if($itemdescr==''){$itemdescr='true';}$hidedate=get_option('choose_hidedate');if($hidedate==''){$hidedate='true';}$itemdate=get_option('choose_itemdate');if($itemdate==''){$itemdate='d MMMM, yyyy';}if($type=='artmuseums'){echo "<div id=\"london_events\"><script src=\"http://feeds.feedburner.com/PluginArtMuseums?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";echo "</div>";}elseif($type=='classical'){echo "<div id=\"london_events\"><script src=\"http://feeds.feedburner.com/PluginClassical?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";echo "</div>";}elseif($type=='music'){echo "<div id=\"london_events\"><script src=\"http://feeds.feedburner.com/PluginMusicConcerts?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";echo "</div>";}elseif($type=='pick'){echo "<div id=\"london_events\"><script src=\"http://feeds.feedburner.com/PluginPick?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";echo "</div>";}elseif($type=='theatre'){echo "<div id=\"london_events\"><script src=\"http://feeds.feedburner.com/PluginTheatreShows?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";echo "</div>";}else{echo "<div id=\"london_events\"><script src=\"http://feeds.feedburner.com/PluginPick?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";echo "</div>";}}function modify_menu(){add_options_page('London Events Guide','London Events Guide','manage_options', _File_,'admin_londonevents_options');}add_action('admin_menu','modify_menu');function admin_londonevents_options(){print("<div style=\"margin:10px 6px 8px 0;padding:0 14px 0 14px;border:1px solid #CCC;\"><h2 style=\"margin:3px -11px 8px;padding:3px 6px;background:#999;color:#FAFAFA;font:bold 22px/22px arial,verdana,sans-serif;text-transform:uppercase;\">London Events Guide</h2>");if($_POST['submit']){upate_londonevents_options();}print_londonevents_form();}function upate_londonevents_options(){if($_POST['choose_type']){update_option('choose_type', $_POST['choose_type']);}if($_POST['choose_itemnum']){update_option('choose_itemnum', $_POST['choose_itemnum']);}if($_POST['choose_itemdescr']){update_option('choose_itemdescr', $_POST['choose_itemdescr']);}if($_POST['choose_hidedate']){update_option('choose_hidedate', $_POST['choose_hidedate']);}if($_POST['choose_itemdate']){update_option('choose_itemdate', $_POST['choose_itemdate']);}if($_POST['event_styles']){update_option('event_styles', $_POST['event_styles']);}}function print_londonevents_form(){$type=get_option('choose_type');if($type==''){$type='pick';}$itemnum=get_option('choose_itemnum');if($itemnum==''){$itemnum='3';}$itemdescr=get_option('choose_itemdescr');if($itemdescr==''){$itemdescr='true';}$hidedate=get_option('choose_hidedate');if($hidedate==''){$hidedate='true';}$itemdate=get_option('choose_itemdate');if($itemdate==''){$itemdate='d MMMM, yyyy';}$styles=get_option('event_styles');if($styles==''){$styles='#london_events {   // this is the main containing block
	background: transparent; border: none;
	}
#london_events li {   // this is the containing block for each individual event
	display: block; clear: both; padding-bottom: 2px;
	}
#london_events li .headline {   // the title of each event
	display: block; clear: both; font-size: 1.2em;
	}
#london_events li .date {   // the date of each event
	color: #666; margin: 0;
	}
#london_events li div p img {   // the image for each event
	display: inline; float: left; margin: 0 10px 6px 0 !important; border: 1px solid #CCC; vertical-align: top;
	}
#london_events sub {   // credit line
	display: block; clear: both; margin-top: 6px;
	}';}echo "<div style=\"float:right;width:300px;margin:0 -6px 8px 1.2em;padding:0 10px 12px 12px;background:#eee;color:#555;border:1px solid #CCC;\"><h3 style=\"margin-top:12px;color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:none;margin-bottom:0;\">Preview: <span style=\"color:#777;text-transform:none;\">";if($type=='artmuseums'){echo "Art and museum exhibitions";}elseif($type=='classical'){echo "Classical music";}elseif($type=='music'){echo "Rock/pop concerts";}elseif($type=='pick'){echo "Pick of the best events";}elseif($type=='theatre'){echo "Theatre shows";}else{echo "Pick of the best events";}echo "</span></h3><p>This is a preview of the '";if($type=='artmuseums'){echo "Art and museum exhibitions";}elseif($type=='classical'){echo "Classical music";}elseif($type=='music'){echo "Rock/pop concerts";}elseif($type=='pick'){echo "Pick of the best events";}elseif($type=='theatre'){echo "Theatre shows";}else{echo "Pick of the best events";}echo "' feed. If you have made any changes to the CSS styles then you may have to refresh the page in order to see them.</p><div style=\"width:270px;margin-bottom:.1em;padding:.8em .95em .35em;background:#FFF;\"><div id=\"london_events\">";if($type=='artmuseums'){echo "<script src=\"http://feeds.feedburner.com/PluginArtMuseums?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";}elseif($type=='classical'){echo "<script src=\"http://feeds.feedburner.com/PluginClassical?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";}elseif($type=='music'){echo "<script src=\"http://feeds.feedburner.com/PluginMusicConcerts?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";}elseif($type=='pick'){echo "<script src=\"http://feeds.feedburner.com/PluginPick?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";}elseif($type=='theatre'){echo "<script src=\"http://feeds.feedburner.com/PluginTheatreShows?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";}else{echo "<script src=\"http://feeds.feedburner.com/PluginPick?format=sigpro&nItems=".$itemnum."&displayExcerpts=".$itemdescr."&displayDate=".$hidedate."&dateFormat=".$itemdate."\" type=\"text/javascript\"></script>";}echo "</div></div><p>Want to know where the events come from?</p><p>The events are pulled straight from the events guide at <a href=\"http://www.londondrum.com/\">www.londondrum.com</a>, so you need never have to worry about updating them.</p></div>";echo "<h3 style=\"margin-top:20px;color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:uppercase;\">Step 1: &nbsp;<span style=\"color:#777;text-transform:none;\">Choose a category</span></h3><p>There are 5 different categories to choose from:</p>";echo "<form method=\"post\"><select name=\"choose_type\"><option value=\"artmuseums\"";if($type=='artmuseums'){echo " selected=selected";}echo ">Art &amp; museum exhibitions&nbsp;&nbsp;</option><option value=\"classical\"";if($type=='classical'){echo " selected=selected";}echo ">Classical music &amp; operas&nbsp;&nbsp;</option><option value=\"pick\"";if($type=='pick'){echo " selected=selected";}echo ">Pick of the best events&nbsp;&nbsp;</option><option value=\"music\"";if($type=='music'){echo " selected=selected";}echo ">Rock &amp; pop concerts&nbsp;&nbsp;</option><option value=\"theatre\"";if($type=='theatre'){echo " selected=selected";}echo ">Theatre shows &amp; musicals&nbsp;&nbsp;</option></select><input type=\"submit\" name=\"submit\" value=\"Submit\"></form>";echo "<h3 style=\"color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:uppercase;\">Step 2: &nbsp;<span style=\"color:#777;text-transform:none;\">Choose the number of events</span></h3><p>You can choose to show between 1 and 5 events:</p>";echo "<form method=\"post\"><select name=\"choose_itemnum\"><option value=\"1\"";if($itemnum=='1'){echo " selected=selected";}echo ">1&nbsp;&nbsp;</option><option value=\"2\"";if($itemnum=='2'){echo " selected=selected";}echo ">2&nbsp;&nbsp;</option><option value=\"3\"";if($itemnum=='3'){echo " selected=selected";}echo ">3&nbsp;&nbsp;</option><option value=\"4\"";if($itemnum=='4'){echo " selected=selected";}echo ">4&nbsp;&nbsp;</option><option value=\"5\"";if($itemnum=='5'){echo " selected=selected";}echo ">5&nbsp;&nbsp;</option></select><input type=\"submit\" name=\"submit\" value=\"Submit\"></form>";echo "<h3 style=\"color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:uppercase;\">Step 3: &nbsp;<span style=\"color:#777;text-transform:none;\">Show / hide the image and description</span></h3><p>If you wish, you can choose to hide the image and description, and just show the title.</p>";echo "<form method=\"post\"><select name=\"choose_itemdescr\"><option value=\"true\"";if($itemdescr=='true'){echo " selected=selected";}echo ">Show the title, image and description&nbsp;&nbsp;</option><option value=\"false\"";if($itemdescr=='false'){echo " selected=selected";}echo ">Show the title, but hide the image and description&nbsp;&nbsp;</option></select><input type=\"submit\" name=\"submit\" value=\"Submit\"></form>";echo "<h3 style=\"color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:uppercase;\">Step 4: &nbsp;<span style=\"color:#777;text-transform:none;\">Show / hide the date</span></h3><p>If you wish, you can also choose to hide the date.</p>";echo "<form method=\"post\"><select name=\"choose_hidedate\"><option value=\"true\"";if($hidedate=='true'){echo " selected=selected";}echo ">Show the date&nbsp;&nbsp;</option><option value=\"false\"";if($hidedate=='false'){echo " selected=selected";}echo ">Hide the date&nbsp;&nbsp;</option></select><input type=\"submit\" name=\"submit\" value=\"Submit\"></form>";echo "<h3 style=\"color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:uppercase;\">Step 5: &nbsp;<span style=\"color:#777;text-transform:none;\">Change the date format</span></h3><p>This next part allows you to change how the date displays.<br>(This will obviously have no effect if you decide to hide the date.)</p>";echo "<form method=\"post\"><select name=\"choose_itemdate\"><option value=\"d/M/yyyy\"";if($itemdate=='d/M/yyyy'){echo " selected=selected";}echo ">25/12/2099&nbsp;&nbsp;</option><option value=\"d-M-yyyy\"";if($itemdate=='d-M-yyyy'){echo " selected=selected";}echo ">25-12-2099&nbsp;&nbsp;</option><option value=\"M/d/yyyy\"";if($itemdate=='M/d/yyyy'){echo " selected=selected";}echo ">12/25/2099&nbsp;&nbsp;</option><option value=\"M-d-yyyy\"";if($itemdate=='M-d-yyyy'){echo " selected=selected";}echo ">12-25-2099&nbsp;&nbsp;</option><option value=\"d MMM, yyyy\"";if($itemdate=='d MMM, yyyy'){echo " selected=selected";}echo ">25 Dec, 2099&nbsp;&nbsp;</option><option value=\"MMM d, yyyy\"";if($itemdate=='MMM d, yyyy'){echo " selected=selected";}echo ">Dec 25, 2099&nbsp;&nbsp;</option><option value=\"d MMMM, yyyy\"";if($itemdate=='d MMMM, yyyy'){echo " selected=selected";}echo ">25 December, 2099&nbsp;&nbsp;</option><option value=\"MMMM d, yyyy\"";if($itemdate=='MMMM d, yyyy'){echo " selected=selected";}echo ">December 25, 2099&nbsp;&nbsp;</option></select><input type=\"submit\" name=\"submit\" value=\"Submit\"></form>";echo "<h3 style=\"color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:uppercase;\">Step 6: &nbsp;<span style=\"color:#777;text-transform:none;\">Change the styles</span></h3><p>This next section shows the current CSS styles. You can change them to whatever you like.</p>";echo "<form method=\"post\"><textarea name=\"event_styles\" style=\"font-size:10px;\" cols=\"82\" rows=\"18\">".$styles."</textarea><input type=\"submit\" name=\"submit\" value=\"Submit\"></form>";echo "<h3 style=\"color:#444;font:bold 16px/16px arial,verdana,sans-serif;text-transform:uppercase;\">Step 7: &nbsp;<span style=\"color:#777;text-transform:none;\">Add the events to your site</span></h3><p>There are two ways of adding the events to your website.<br><br>1) You can navigate to 'Appearance > Widgets' and drag the 'London Events Guide' widget onto your sidebar<br><br>or 2) You can add the following line to one of your Wordpress templates, wherever you&#8217;d like the events to appear:</p><div style=\"width:60%;padding:1em;background:#FFF;border:1px solid #AAA;margin-bottom:1.2em\"><code>&lt;?php if (function_exists('london_events')){london_events();} ?&gt;</code></div><p style=\"margin-bottom:1.2em\">And that&#8217;s it!</p>";}function londonevents_styles(){$styles=get_option('event_styles');if($styles==''){$styles='#london_events {   // this is the main containing block
	background: transparent; border: none;
	}
#london_events li {   // this is the containing block for each individual event
	display: block; clear: both; padding-bottom: 2px;
	}
#london_events li .headline {   // the title of each event
	display: block; clear: both; font-size: 1.2em;
	}
#london_events li .date {   // the date of each event
	color: #666; margin: 0;
	}
#london_events li div p img {   // the image for each event
	display: inline; float: left; margin: 0 10px 6px 0 !important; border: 1px solid #CCC; vertical-align: top;
	}
#london_events sub {   // credit line
	display: block; clear: both; margin-top: 6px;
	}';}echo "<style type=\"text/css\">".$styles."
#creditfooter{display:none;}</style>";}add_action('wp_head','londonevents_styles');add_action('admin_head','londonevents_styles');function widget_londonevents($args){extract($args);$options=get_option("widget_londonevents");if(!is_array( $options)){$options=array('title'=>'Upcoming events');}echo $before_widget;echo $before_title;echo $options['title'];echo $after_title;london_events();echo $after_widget;}function londonevents_control(){$options=get_option("widget_londonevents");if (!is_array( $options)){$options=array('title'=>'Upcoming events');}if ($_POST['londonevents-Submit']){$options['title']=htmlspecialchars($_POST['londonevents-WidgetTitle']);  update_option("widget_londonevents", $options);}?><p><label for="londonevents-WidgetTitle">Title: </label><input type="text" id="londonevents-WidgetTitle" name="londonevents-WidgetTitle" value="<?php echo $options['title'];?>" /><input type="hidden" id="londonevents-Submit" name="londonevents-Submit" value="1" /></p><?php }function londonevents_init(){register_sidebar_widget(__('London Events Guide'),'widget_londonevents'); register_widget_control('London Events Guide','londonevents_control', 200, 200);}add_action("plugins_loaded", "londonevents_init");
?>